"use strict";(globalThis.webpackChunkt_ruby_docs=globalThis.webpackChunkt_ruby_docs||[]).push([[7390],{7390:(e,n,o)=>{o.d(n,{loadTRubyCompiler:()=>c});const r="https://cdn.jsdelivr.net/npm/@ruby/3.3-wasm-wasi@2.7.0/dist/browser/+esm",s="https://cdn.jsdelivr.net/npm/@ruby/3.3-wasm-wasi@2.7.0/dist/ruby+stdlib.wasm";let t=null,l=null,a=null;const i='\nrequire "json"\n\n# Global compiler instance\n$trb_compiler = nil\n\ndef get_compiler\n  $trb_compiler ||= TRuby::Compiler.new\nend\n\ndef __trb_compile__(code)\n  compiler = get_compiler\n\n  begin\n    result = compiler.compile_string(code)\n\n    {\n      success: result[:errors].empty?,\n      ruby: result[:ruby] || "",\n      rbs: result[:rbs] || "",\n      errors: result[:errors] || []\n    }.to_json\n  rescue TRuby::ParseError => e\n    {\n      success: false,\n      ruby: "",\n      rbs: "",\n      errors: [e.message]\n    }.to_json\n  rescue StandardError => e\n    {\n      success: false,\n      ruby: "",\n      rbs: "",\n      errors: ["Compilation error: " + e.message]\n    }.to_json\n  end\nend\n\ndef __trb_health_check__\n  {\n    loaded: defined?(TRuby) == "constant",\n    version: defined?(TRuby::VERSION) ? TRuby::VERSION : "unknown",\n    ruby_version: RUBY_VERSION\n  }.to_json\nend\n\ndef __trb_version__\n  {\n    t_ruby: defined?(TRuby::VERSION) ? TRuby::VERSION : "unknown",\n    ruby: RUBY_VERSION\n  }.to_json\nend\n';async function c(e){if(l)return e?.({state:"ready",message:"Compiler ready"}),l;if(a)return a;a=async function(e){try{console.log("[T-Ruby] Step 1: Loading Ruby WASM module from",r),e?.({state:"loading",message:"Loading Ruby runtime...",progress:10});const{DefaultRubyVM:n}=await import(r);console.log("[T-Ruby] Step 1 complete: DefaultRubyVM loaded"),e?.({state:"loading",message:"Downloading Ruby WASM binary...",progress:30}),console.log("[T-Ruby] Step 2: Fetching WASM binary from",s);const o=await fetch(s);console.log("[T-Ruby] Step 2: WASM fetch response status:",o.status);const l=await WebAssembly.compileStreaming(o);console.log("[T-Ruby] Step 2 complete: WASM module compiled"),e?.({state:"loading",message:"Initializing Ruby VM...",progress:60}),console.log("[T-Ruby] Step 3: Initializing Ruby VM...");const{vm:a}=await n(l);t=a,console.log("[T-Ruby] Step 3 complete: Ruby VM initialized"),e?.({state:"loading",message:"Loading T-Ruby compiler...",progress:80}),console.log("[T-Ruby] Step 4: Loading T-Ruby compiler bootstrap..."),a.eval(i),console.log("[T-Ruby] Step 4 complete: Bootstrap code evaluated");const c=a.eval("__trb_health_check__");return console.log("[T-Ruby] Health check:",c.toString()),e?.({state:"ready",message:"Compiler ready",progress:100}),{compile(e){console.log("[T-Ruby] Compiling code:",e.substring(0,100)+(e.length>100?"...":""));try{const n=a.eval(`__trb_compile__(${JSON.stringify(e)})`).toString();console.log("[T-Ruby] Raw compile result:",n);const o=JSON.parse(n);return console.log("[T-Ruby] Parsed compile result:",o),o}catch(n){throw console.error("[T-Ruby] Compile error:",n),n}},healthCheck(){const e=a.eval("__trb_health_check__");return JSON.parse(e.toString())},getVersion(){const e=a.eval("__trb_version__");return JSON.parse(e.toString())}}}catch(n){throw console.error("[T-Ruby] Loading error:",n),e?.({state:"error",message:n instanceof Error?n.message:"Unknown error"}),n}}(e);try{return l=await a,l}catch(n){throw a=null,n}}}}]);