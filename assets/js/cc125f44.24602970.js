"use strict";(globalThis.webpackChunkt_ruby_docs=globalThis.webpackChunkt_ruby_docs||[]).push([[5077],{2339(e,n,i){i.r(n),i.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"tooling/migrating-from-ruby","title":"Migrating from Ruby","description":"Guide to migrating existing Ruby projects to T-Ruby","source":"@site/docs/tooling/migrating-from-ruby.md","sourceDirName":"tooling","slug":"/tooling/migrating-from-ruby","permalink":"/docs/tooling/migrating-from-ruby","draft":false,"unlisted":false,"editUrl":"https://github.com/type-ruby/t-ruby.github.io/tree/main/docs/tooling/migrating-from-ruby.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4,"title":"Migrating from Ruby","description":"Guide to migrating existing Ruby projects to T-Ruby"},"sidebar":"docsSidebar","previous":{"title":"Using with Ruby LSP","permalink":"/docs/tooling/ruby-lsp"},"next":{"title":"Type Syntax Cheatsheet","permalink":"/docs/reference/cheatsheet"}}');var t=i(5656),r=i(6145);const a={sidebar_position:4,title:"Migrating from Ruby",description:"Guide to migrating existing Ruby projects to T-Ruby"},l="Migrating from Ruby",d={},c=[{value:"Migration Strategy",id:"migration-strategy",level:2},{value:"1. Incremental Adoption",id:"1-incremental-adoption",level:3},{value:"2. Bottom-Up Approach",id:"2-bottom-up-approach",level:3},{value:"3. Strictness Levels",id:"3-strictness-levels",level:3},{value:"Step-by-Step Migration",id:"step-by-step-migration",level:2},{value:"Step 1: Set Up T-Ruby",id:"step-1-set-up-t-ruby",level:3},{value:"Step 2: Choose a Starting Point",id:"step-2-choose-a-starting-point",level:3},{value:"Step 3: Rename to .trb",id:"step-3-rename-to-trb",level:3},{value:"Step 4: Add Basic Types",id:"step-4-add-basic-types",level:3},{value:"Step 5: Compile and Fix Errors",id:"step-5-compile-and-fix-errors",level:3},{value:"Step 6: Gradual Expansion",id:"step-6-gradual-expansion",level:3},{value:"Common Migration Patterns",id:"common-migration-patterns",level:2},{value:"Pattern 1: Simple Data Class",id:"pattern-1-simple-data-class",level:3},{value:"Pattern 2: Service Class",id:"pattern-2-service-class",level:3},{value:"Pattern 3: Module with Mixins",id:"pattern-3-module-with-mixins",level:3},{value:"Pattern 4: Hash-Heavy Code",id:"pattern-4-hash-heavy-code",level:3},{value:"Pattern 5: Dynamic Method Calls",id:"pattern-5-dynamic-method-calls",level:3},{value:"Handling Challenging Code",id:"handling-challenging-code",level:2},{value:"Nil Handling",id:"nil-handling",level:3},{value:"Complex Hashes",id:"complex-hashes",level:3},{value:"Duck Typing",id:"duck-typing",level:3},{value:"Metaprogramming",id:"metaprogramming",level:3},{value:"Configuration for Migration",id:"configuration-for-migration",level:2},{value:"Permissive Mode",id:"permissive-mode",level:3},{value:"Gradual Strictness",id:"gradual-strictness",level:3},{value:"Final Strict Mode",id:"final-strict-mode",level:3},{value:"Mixed Codebase",id:"mixed-codebase",level:2},{value:"Testing During Migration",id:"testing-during-migration",level:2},{value:"Test Both Versions",id:"test-both-versions",level:3},{value:"Type-Check Before Tests",id:"type-check-before-tests",level:3},{value:"CI Configuration",id:"ci-configuration",level:3},{value:"Migration Checklist",id:"migration-checklist",level:2},{value:"Phase 1: Setup",id:"phase-1-setup",level:3},{value:"Phase 2: Initial Migration",id:"phase-2-initial-migration",level:3},{value:"Phase 3: Expansion",id:"phase-3-expansion",level:3},{value:"Phase 4: Completion",id:"phase-4-completion",level:3},{value:"Tips for Successful Migration",id:"tips-for-successful-migration",level:2},{value:"1. Start Small",id:"1-start-small",level:3},{value:"2. Focus on Value",id:"2-focus-on-value",level:3},{value:"3. Use Type Aliases",id:"3-use-type-aliases",level:3},{value:"4. Document Patterns",id:"4-document-patterns",level:3},{value:"5. Leverage Tools",id:"5-leverage-tools",level:3},{value:"6. Be Pragmatic",id:"6-be-pragmatic",level:3},{value:"Rollback Strategy",id:"rollback-strategy",level:2},{value:"Keep Original Files",id:"keep-original-files",level:3},{value:"Use Git Branches",id:"use-git-branches",level:3},{value:"Incremental Commits",id:"incremental-commits",level:3},{value:"Real-World Example",id:"real-world-example",level:2},{value:"Next Steps",id:"next-steps",level:2},{value:"Resources",id:"resources",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components},{DocsBadge:i}=n;return i||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("DocsBadge",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(i,{}),"\n",(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"migrating-from-ruby",children:"Migrating from Ruby"})}),"\n",(0,t.jsx)(n.p,{children:"Migrating an existing Ruby codebase to T-Ruby is a gradual process. Thanks to T-Ruby's optional type system, you can adopt types incrementally without rewriting everything at once."}),"\n",(0,t.jsx)(n.h2,{id:"migration-strategy",children:"Migration Strategy"}),"\n",(0,t.jsx)(n.h3,{id:"1-incremental-adoption",children:"1. Incremental Adoption"}),"\n",(0,t.jsx)(n.p,{children:"You don't need to migrate everything at once. T-Ruby is designed for gradual adoption:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Start with a single file or module"}),"\n",(0,t.jsx)(n.li,{children:"Add types to new code first"}),"\n",(0,t.jsx)(n.li,{children:"Migrate existing code as you touch it"}),"\n",(0,t.jsxs)(n.li,{children:["Mix ",(0,t.jsx)(n.code,{children:".rb"})," and ",(0,t.jsx)(n.code,{children:".trb"})," files in the same project"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-bottom-up-approach",children:"2. Bottom-Up Approach"}),"\n",(0,t.jsx)(n.p,{children:"Migrate from the bottom of your dependency tree upward:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Utility functions"})," - Pure functions with clear inputs/outputs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Data models"})," - Classes representing data structures"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Services"})," - Business logic layers"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Controllers/Views"})," - Higher-level application code"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-strictness-levels",children:"3. Strictness Levels"}),"\n",(0,t.jsx)(n.p,{children:"Use different strictness levels during migration:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Permissive"})," - Start here, minimal type requirements"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Standard"})," - Move to this once basic types are in place"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Strict"})," - Final goal for maximum type safety"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"step-by-step-migration",children:"Step-by-Step Migration"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-set-up-t-ruby",children:"Step 1: Set Up T-Ruby"}),"\n",(0,t.jsx)(n.p,{children:"Install T-Ruby in your project:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"gem install t-ruby\n"})}),"\n",(0,t.jsx)(n.p,{children:"Or add to Gemfile:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'group :development do\n  gem "t-ruby"\nend\n'})}),"\n",(0,t.jsx)(n.p,{children:"Initialize configuration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"trc --init\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-choose-a-starting-point",children:"Step 2: Choose a Starting Point"}),"\n",(0,t.jsx)(n.p,{children:"Pick a file to migrate. Good candidates:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Data classes"})," - Clear structure, minimal dependencies:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",metastring:'title="user.rb"',children:'class User\n  attr_reader :id, :name, :email\n\n  def initialize(id, name, email)\n    @id = id\n    @name = name\n    @email = email\n  end\n\n  def display_name\n    "#{name} (#{email})"\n  end\nend\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Pure functions"})," - Predictable inputs and outputs:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",metastring:'title="calculator.rb"',children:"def calculate_tax(amount, rate)\n  amount * rate\nend\n\ndef format_currency(amount)\n  \"$#{sprintf('%.2f', amount)}\"\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-3-rename-to-trb",children:"Step 3: Rename to .trb"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"mv user.rb user.trb\n"})}),"\n",(0,t.jsx)(n.p,{children:"At this point, the file is still valid Ruby - all Ruby is valid T-Ruby."}),"\n",(0,t.jsx)(n.h3,{id:"step-4-add-basic-types",children:"Step 4: Add Basic Types"}),"\n",(0,t.jsx)(n.p,{children:"Start with simple type annotations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",metastring:'title="user.trb"',children:'class User\n  @id: Integer\n  @name: String\n  @email: String\n\n  attr_reader :id, :name, :email\n\n  def initialize(id: Integer, name: String, email: String): void\n    @id = id\n    @name = name\n    @email = email\n  end\n\n  def display_name: String\n    "#{@name} (#{@email})"\n  end\nend\n'})}),"\n",(0,t.jsx)(n.h3,{id:"step-5-compile-and-fix-errors",children:"Step 5: Compile and Fix Errors"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"trc compile user.trb\n"})}),"\n",(0,t.jsx)(n.p,{children:"Fix any type errors that appear:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Error: user.trb:12:5\n  Type mismatch: expected String, got nil\n\n  @email = params[:email]\n           ^^^^^^^^^^^^^^\n\nHint: Did you mean: String | nil ?\n"})}),"\n",(0,t.jsx)(n.p,{children:"Fix:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:'def initialize(id: Integer, name: String, email: String | nil): void\n  @id = id\n  @name = name\n  @email = email || "no-email@example.com"\nend\n'})}),"\n",(0,t.jsx)(n.h3,{id:"step-6-gradual-expansion",children:"Step 6: Gradual Expansion"}),"\n",(0,t.jsx)(n.p,{children:"Once one file works, migrate related files:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Before:\n  user.rb \u2713 Migrated to user.trb\n  post.rb \u2190 Migrate next\n  comment.rb\n\nAfter:\n  user.trb \u2713\n  post.trb \u2713\n  comment.rb\n"})}),"\n",(0,t.jsx)(n.h2,{id:"common-migration-patterns",children:"Common Migration Patterns"}),"\n",(0,t.jsx)(n.h3,{id:"pattern-1-simple-data-class",children:"Pattern 1: Simple Data Class"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"class Product\n  attr_accessor :id, :name, :price, :in_stock\n\n  def initialize(id, name, price, in_stock = true)\n    @id = id\n    @name = name\n    @price = price\n    @in_stock = in_stock\n  end\n\n  def discounted_price(percentage)\n    @price * (1 - percentage / 100.0)\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (T-Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"class Product\n  @id: Integer\n  @name: String\n  @price: Float\n  @in_stock: Boolean\n\n  attr_accessor :id, :name, :price, :in_stock\n\n  def initialize(\n    id: Integer,\n    name: String,\n    price: Float,\n    in_stock: Boolean = true\n  ): void\n    @id = id\n    @name = name\n    @price = price\n    @in_stock = in_stock\n  end\n\n  def discounted_price(percentage: Float): Float\n    @price * (1 - percentage / 100.0)\n  end\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-2-service-class",children:"Pattern 2: Service Class"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"class UserService\n  def find_user(id)\n    # Database lookup\n    User.find(id)\n  end\n\n  def create_user(attributes)\n    User.create(attributes)\n  end\n\n  def active_users\n    User.where(active: true)\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (T-Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"class UserService\n  def find_user(id: Integer): User | nil\n    User.find(id)\n  end\n\n  def create_user(attributes: Hash<String, Any>): User\n    User.create(attributes)\n  end\n\n  def active_users: User[]\n    User.where(active: true)\n  end\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-3-module-with-mixins",children:"Pattern 3: Module with Mixins"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"module Timestampable\n  def created_at\n    @created_at\n  end\n\n  def updated_at\n    @updated_at\n  end\n\n  def touch\n    @updated_at = Time.now\n  end\nend\n\nclass Post\n  include Timestampable\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (T-Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"module Timestampable\n  @created_at: Time\n  @updated_at: Time\n\n  def created_at: Time\n    @created_at\n  end\n\n  def updated_at: Time\n    @updated_at\n  end\n\n  def touch: void\n    @updated_at = Time.now\n  end\nend\n\nclass Post\n  include Timestampable\n\n  @title: String\n  @content: String\n\n  def initialize(title: String, content: String): void\n    @title = title\n    @content = content\n    @created_at = Time.now\n    @updated_at = Time.now\n  end\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-4-hash-heavy-code",children:"Pattern 4: Hash-Heavy Code"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'def process_order(order_data)\n  {\n    order_id: order_data[:id],\n    total: calculate_total(order_data[:items]),\n    status: "pending"\n  }\nend\n\ndef calculate_total(items)\n  items.sum { |item| item[:price] * item[:quantity] }\nend\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (T-Ruby):"]}),"\n",(0,t.jsx)(n.p,{children:"Define type aliases for clarity:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:'type OrderData = Hash<Symbol, Any>\ntype OrderItem = Hash<Symbol, Any>\ntype OrderResult = Hash<Symbol, String | Integer>\n\ndef process_order(order_data: OrderData): OrderResult\n  {\n    order_id: order_data[:id].to_i,\n    total: calculate_total(order_data[:items]),\n    status: "pending"\n  }\nend\n\ndef calculate_total(items: OrderItem[]): Integer\n  items.sum { |item| item[:price].to_i * item[:quantity].to_i }\nend\n'})}),"\n",(0,t.jsx)(n.p,{children:"Or use structured types:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"class OrderItem\n  @price: Integer\n  @quantity: Integer\n\n  def initialize(price: Integer, quantity: Integer): void\n    @price = price\n    @quantity = quantity\n  end\n\n  def total: Integer\n    @price * @quantity\n  end\nend\n\ndef calculate_total(items: OrderItem[]): Integer\n  items.sum(&:total)\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"pattern-5-dynamic-method-calls",children:"Pattern 5: Dynamic Method Calls"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (Ruby):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"class DynamicModel\n  def method_missing(method, *args)\n    if method.to_s.start_with?('find_by_')\n      attribute = method.to_s.sub('find_by_', '')\n      find_by(attribute, args.first)\n    else\n      super\n    end\n  end\n\n  def find_by(attribute, value)\n    # Database query\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (T-Ruby):"]}),"\n",(0,t.jsx)(n.p,{children:"Use explicit methods or define types:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:'class DynamicModel\n  # Explicit methods for type safety\n  def find_by_name(name: String): DynamicModel | nil\n    find_by("name", name)\n  end\n\n  def find_by_email(email: String): DynamicModel | nil\n    find_by("email", email)\n  end\n\n  private\n\n  def find_by(attribute: String, value: String): DynamicModel | nil\n    # Database query\n  end\nend\n'})}),"\n",(0,t.jsx)(n.p,{children:"Or use generics for flexible typing:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"class DynamicModel\n  def find_by<T>(attribute: String, value: T): DynamicModel | nil\n    # Database query\n  end\nend\n"})}),"\n",(0,t.jsx)(n.h2,{id:"handling-challenging-code",children:"Handling Challenging Code"}),"\n",(0,t.jsx)(n.h3,{id:"nil-handling",children:"Nil Handling"}),"\n",(0,t.jsx)(n.p,{children:"Ruby code often uses nil implicitly:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"def find_user(id)\n  users.find { |u| u.id == id }\nend\n\nuser = find_user(123)\nuser.name  # Might crash if nil!\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"def find_user(id: Integer): User | nil\n  users.find { |u| u.id == id }\nend\n\nuser = find_user(123)\nif user\n  user.name  # Safe - nil checked\nend\n\n# Or use safe navigation\nuser&.name\n"})}),"\n",(0,t.jsx)(n.h3,{id:"complex-hashes",children:"Complex Hashes"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'config = {\n  database: {\n    host: "localhost",\n    port: 5432,\n    credentials: {\n      username: "admin",\n      password: "secret"\n    }\n  }\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," - Use structured classes:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:'class Credentials\n  @username: String\n  @password: String\n\n  def initialize(username: String, password: String): void\n    @username = username\n    @password = password\n  end\nend\n\nclass DatabaseConfig\n  @host: String\n  @port: Integer\n  @credentials: Credentials\n\n  def initialize(\n    host: String,\n    port: Integer,\n    credentials: Credentials\n  ): void\n    @host = host\n    @port = port\n    @credentials = credentials\n  end\nend\n\nclass Config\n  @database: DatabaseConfig\n\n  def initialize(database: DatabaseConfig): void\n    @database = database\n  end\nend\n\n# Usage\nconfig = Config.new(\n  DatabaseConfig.new(\n    "localhost",\n    5432,\n    Credentials.new("admin", "secret")\n  )\n)\n'})}),"\n",(0,t.jsx)(n.h3,{id:"duck-typing",children:"Duck Typing"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:"def format(object)\n  if object.respond_to?(:to_s)\n    object.to_s\n  else\n    object.inspect\n  end\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," - Use interfaces:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"interface Stringable\n  def to_s: String\nend\n\ndef format<T>(object: T): String\n  if object.is_a?(Stringable)\n    object.to_s\n  else\n    object.inspect\n  end\nend\n"})}),"\n",(0,t.jsx)(n.h3,{id:"metaprogramming",children:"Metaprogramming"}),"\n",(0,t.jsx)(n.p,{children:"Some metaprogramming can't be typed easily. Options:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Refactor"})," to explicit code"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use Any"})," type for dynamic parts"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Keep as .rb"})," file (don't migrate)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'class DynamicClass\n  [:foo, :bar, :baz].each do |method_name|\n    define_method(method_name) do |arg|\n      instance_variable_set("@#{method_name}", arg)\n    end\n  end\nend\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," - Explicit methods:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"class DynamicClass\n  @foo: Any\n  @bar: Any\n  @baz: Any\n\n  def foo(arg: Any): void\n    @foo = arg\n  end\n\n  def bar(arg: Any): void\n    @bar = arg\n  end\n\n  def baz(arg: Any): void\n    @baz = arg\n  end\nend\n"})}),"\n",(0,t.jsx)(n.h2,{id:"configuration-for-migration",children:"Configuration for Migration"}),"\n",(0,t.jsx)(n.h3,{id:"permissive-mode",children:"Permissive Mode"}),"\n",(0,t.jsx)(n.p,{children:"Start with permissive mode during migration:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="trbconfig.yml"',children:"compiler:\n  strictness: permissive\n\n  checks:\n    no_implicit_any: false\n    strict_nil: false\n    no_unused_vars: false\n"})}),"\n",(0,t.jsx)(n.p,{children:"This allows:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Untyped parameters"}),"\n",(0,t.jsxs)(n.li,{children:["Implicit ",(0,t.jsx)(n.code,{children:"any"})," types"]}),"\n",(0,t.jsx)(n.li,{children:"Missing return types"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"gradual-strictness",children:"Gradual Strictness"}),"\n",(0,t.jsx)(n.p,{children:"As you add more types, increase strictness:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="trbconfig.yml"',children:"compiler:\n  strictness: standard  # Move from permissive\n\n  checks:\n    no_implicit_any: true  # Enable gradually\n    strict_nil: true\n    no_unused_vars: false  # Enable later\n"})}),"\n",(0,t.jsx)(n.h3,{id:"final-strict-mode",children:"Final Strict Mode"}),"\n",(0,t.jsx)(n.p,{children:"Once fully migrated:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="trbconfig.yml"',children:"compiler:\n  strictness: strict\n\n  checks:\n    no_implicit_any: true\n    strict_nil: true\n    no_unused_vars: true\n    no_unchecked_indexed_access: true\n"})}),"\n",(0,t.jsx)(n.h2,{id:"mixed-codebase",children:"Mixed Codebase"}),"\n",(0,t.jsx)(n.p,{children:"You can mix Ruby and T-Ruby files:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"app/\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 user.trb          # Migrated\n\u2502   \u251c\u2500\u2500 post.trb          # Migrated\n\u2502   \u2514\u2500\u2500 comment.rb        # Still Ruby\n\u251c\u2500\u2500 services/\n\u2502   \u251c\u2500\u2500 auth.trb          # Migrated\n\u2502   \u2514\u2500\u2500 email.rb          # Still Ruby\n\u2514\u2500\u2500 controllers/\n    \u2514\u2500\u2500 users_controller.rb  # Still Ruby\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Configure T-Ruby to only compile ",(0,t.jsx)(n.code,{children:".trb"})," files:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title="trbconfig.yml"',children:"source:\n  include:\n    - app/models\n    - app/services\n\n  extensions:\n    - .trb  # Only compile .trb files\n"})}),"\n",(0,t.jsx)(n.p,{children:"Generated Ruby files work alongside existing Ruby:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"app/\n\u251c\u2500\u2500 models/\n\u2502   \u251c\u2500\u2500 user.rb           # Compiled from user.trb\n\u2502   \u251c\u2500\u2500 post.rb           # Compiled from post.trb\n\u2502   \u2514\u2500\u2500 comment.rb        # Original Ruby\n"})}),"\n",(0,t.jsx)(n.h2,{id:"testing-during-migration",children:"Testing During Migration"}),"\n",(0,t.jsx)(n.h3,{id:"test-both-versions",children:"Test Both Versions"}),"\n",(0,t.jsx)(n.p,{children:"Keep tests in Ruby, run against compiled code:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"test/\n\u251c\u2500\u2500 user_test.rb\n\u251c\u2500\u2500 post_test.rb\n\u2514\u2500\u2500 comment_test.rb\n\n# Tests run against build/\nruby -Itest -Ibuild test/user_test.rb\n"})}),"\n",(0,t.jsx)(n.h3,{id:"type-check-before-tests",children:"Type-Check Before Tests"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Type check first\ntrc check src/\n\n# If passes, compile and test\ntrc compile src/\nbundle exec rake test\n"})}),"\n",(0,t.jsx)(n.h3,{id:"ci-configuration",children:"CI Configuration"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",metastring:'title=".github/workflows/ci.yml"',children:"- name: Type Check T-Ruby\n  run: trc check src/\n\n- name: Compile T-Ruby\n  run: trc compile src/\n\n- name: Run Tests\n  run: bundle exec rake test\n\n- name: Check with Steep (optional)\n  run: steep check\n"})}),"\n",(0,t.jsx)(n.h2,{id:"migration-checklist",children:"Migration Checklist"}),"\n",(0,t.jsx)(n.h3,{id:"phase-1-setup",children:"Phase 1: Setup"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Install T-Ruby"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Create ",(0,t.jsx)(n.code,{children:"trbconfig.yml"})," configuration"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set up watch mode"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configure CI for type checking"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"phase-2-initial-migration",children:"Phase 2: Initial Migration"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Identify starting files (data models, utilities)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Rename ",(0,t.jsx)(n.code,{children:".rb"})," to ",(0,t.jsx)(n.code,{children:".trb"})]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add basic type annotations"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Compile and fix errors"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Run tests"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"phase-3-expansion",children:"Phase 3: Expansion"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Migrate related files"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Add stricter type checking"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Generate RBS files"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Set up Steep (optional)"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configure Ruby LSP"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"phase-4-completion",children:"Phase 4: Completion"}),"\n",(0,t.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Migrate remaining files"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Enable strict mode"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Document type conventions"]}),"\n",(0,t.jsxs)(n.li,{className:"task-list-item",children:[(0,t.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Train team on T-Ruby"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"tips-for-successful-migration",children:"Tips for Successful Migration"}),"\n",(0,t.jsx)(n.h3,{id:"1-start-small",children:"1. Start Small"}),"\n",(0,t.jsx)(n.p,{children:"Don't try to migrate everything at once. Start with:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"One file"}),"\n",(0,t.jsx)(n.li,{children:"One module"}),"\n",(0,t.jsx)(n.li,{children:"One feature"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"2-focus-on-value",children:"2. Focus on Value"}),"\n",(0,t.jsx)(n.p,{children:"Migrate code where types provide the most value:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Public APIs"}),"\n",(0,t.jsx)(n.li,{children:"Complex business logic"}),"\n",(0,t.jsx)(n.li,{children:"Data models"}),"\n",(0,t.jsx)(n.li,{children:"Frequently modified code"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"3-use-type-aliases",children:"3. Use Type Aliases"}),"\n",(0,t.jsx)(n.p,{children:"Make complex types readable:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:"type UserId = Integer\ntype UserAttributes = Hash<String, String | Integer | Boolean>\ntype UserList = User[]\n"})}),"\n",(0,t.jsx)(n.h3,{id:"4-document-patterns",children:"4. Document Patterns"}),"\n",(0,t.jsx)(n.p,{children:"Create a style guide for your team:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-markdown",children:"# T-Ruby Style Guide\n\n## Naming\n- Use PascalCase for types: `UserId`, `UserData`\n- Use explicit types for public methods\n- Private methods can omit types\n\n## Patterns\n- Prefer structured classes over hashes\n- Use `String | nil` instead of implicit nil\n- Add return type for all public methods\n"})}),"\n",(0,t.jsx)(n.h3,{id:"5-leverage-tools",children:"5. Leverage Tools"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Watch mode"})," - Auto-compile on save"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Ruby LSP"})," - IDE support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Steep"})," - Additional validation"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"6-be-pragmatic",children:"6. Be Pragmatic"}),"\n",(0,t.jsx)(n.p,{children:"Not everything needs full types:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Use ",(0,t.jsx)(n.code,{children:"Any"})," for truly dynamic code"]}),"\n",(0,t.jsxs)(n.li,{children:["Keep metaprogramming in ",(0,t.jsx)(n.code,{children:".rb"})," files"]}),"\n",(0,t.jsx)(n.li,{children:"Focus on public interfaces"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"rollback-strategy",children:"Rollback Strategy"}),"\n",(0,t.jsx)(n.p,{children:"If migration isn't working:"}),"\n",(0,t.jsx)(n.h3,{id:"keep-original-files",children:"Keep Original Files"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Before renaming\ncp user.rb user.rb.bak\n\n# If issues, restore\nmv user.rb.bak user.rb\n"})}),"\n",(0,t.jsx)(n.h3,{id:"use-git-branches",children:"Use Git Branches"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git checkout -b migrate-user-model\n# Make changes\n# If it works:\ngit checkout main\ngit merge migrate-user-model\n# If not:\ngit checkout main\ngit branch -D migrate-user-model\n"})}),"\n",(0,t.jsx)(n.h3,{id:"incremental-commits",children:"Incremental Commits"}),"\n",(0,t.jsx)(n.p,{children:"Commit each file migration separately:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'git add user.trb\ngit commit -m "Migrate User model to T-Ruby"\n\n# If this causes issues, easy to revert:\ngit revert HEAD\n'})}),"\n",(0,t.jsx)(n.h2,{id:"real-world-example",children:"Real-World Example"}),"\n",(0,t.jsx)(n.p,{children:"Complete migration of a simple Rails model:"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Before"})," (",(0,t.jsx)(n.code,{children:"app/models/article.rb"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ruby",children:'class Article < ApplicationRecord\n  belongs_to :user\n  has_many :comments\n\n  validates :title, :content, presence: true\n\n  def published?\n    published_at.present?\n  end\n\n  def publish!\n    update!(published_at: Time.now)\n  end\n\n  def preview(length = 100)\n    content[0...length] + "..."\n  end\n\n  def self.recent(limit = 10)\n    order(created_at: :desc).limit(limit)\n  end\nend\n'})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"After"})," (",(0,t.jsx)(n.code,{children:"app/models/article.trb"}),"):"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-trb",children:'class Article < ApplicationRecord\n  @id: Integer\n  @title: String\n  @content: String\n  @published_at: Time | nil\n  @user_id: Integer\n  @created_at: Time\n  @updated_at: Time\n\n  belongs_to :user\n  has_many :comments\n\n  validates :title, :content, presence: true\n\n  def published?: Boolean\n    !@published_at.nil?\n  end\n\n  def publish!: void\n    update!(published_at: Time.now)\n  end\n\n  def preview(length: Integer = 100): String\n    @content[0...length] + "..."\n  end\n\n  def self.recent(limit: Integer = 10): Article[]\n    order(created_at: :desc).limit(limit)\n  end\nend\n'})}),"\n",(0,t.jsx)(n.h2,{id:"next-steps",children:"Next Steps"}),"\n",(0,t.jsx)(n.p,{children:"After migration:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Enable stricter checking"})," - Gradually increase type safety"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Set up Steep"})," - Additional type validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Configure Ruby LSP"})," - Better IDE support"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Document patterns"})," - Create team guidelines"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Continue migrating"})," - Expand to more files"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"resources",children:"Resources"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/learn/basics/type-annotations",children:"Type Annotations Guide"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/cli/configuration",children:"Configuration Reference"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/tooling/rbs-integration",children:"RBS Integration"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/tooling/steep",children:"Using with Steep"})}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},6145(e,n,i){i.d(n,{R:()=>a,x:()=>l});var s=i(7140);const t={},r=s.createContext(t);function a(e){const n=s.useContext(r);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),s.createElement(r.Provider,{value:n},e.children)}}}]);