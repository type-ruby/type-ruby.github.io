"use strict";(globalThis.webpackChunkt_ruby_docs=globalThis.webpackChunkt_ruby_docs||[]).push([[4211,6592],{4211(e,r,s){s.d(r,{cleanupCompiler:()=>g,loadTRubyCompiler:()=>m});const o=3,n=1e3,t=6e4;let a=null,u=null,l=null,i=0;function c(e){return new Promise(r=>setTimeout(r,e))}function y(e,r){const s=e instanceof Error?e.message:String(e);return s.includes("Failed to fetch")||s.includes("NetworkError")?"\ub124\ud2b8\uc6cc\ud06c \uc624\ub958: WASM \ud30c\uc77c\uc744 \ub2e4\uc6b4\ub85c\ub4dc\ud558\uc9c0 \ubabb\ud588\uc2b5\ub2c8\ub2e4. \uc778\ud130\ub137 \uc5f0\uacb0\uc744 \ud655\uc778\ud574\uc8fc\uc138\uc694.":s.includes("out of memory")||s.includes("OOM")?"\uba54\ubaa8\ub9ac \ubd80\uc871: \ube0c\ub77c\uc6b0\uc800 \uba54\ubaa8\ub9ac\uac00 \ubd80\uc871\ud569\ub2c8\ub2e4. \ub2e4\ub978 \ud0ed\uc744 \ub2eb\uace0 \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.":s.includes("timeout")||s.includes("Timeout")?`\uc2dc\uac04 \ucd08\uacfc: ${r} \uc791\uc5c5\uc774 \ub108\ubb34 \uc624\ub798 \uac78\ub838\uc2b5\ub2c8\ub2e4. \ub2e4\uc2dc \uc2dc\ub3c4\ud574\uc8fc\uc138\uc694.`:s.includes("WebAssembly")?"WASM \uc624\ub958: \ube0c\ub77c\uc6b0\uc800\uac00 WebAssembly\ub97c \uc9c0\uc6d0\ud558\uc9c0 \uc54a\uac70\ub098 \ucd08\uae30\ud654\uc5d0 \uc2e4\ud328\ud588\uc2b5\ub2c8\ub2e4.":`${r} \uc2e4\ud328: ${s}`}async function m(e){if(a)return e?.({state:"ready",message:"Compiler ready",progress:100}),a;if(u)return u;u=async function(e){let r=null;for(let a=0;a<=o;a++)try{if(i=a,a>0){const r=n*Math.pow(2,a-1);e?.({state:"loading",message:`\uc7ac\uc2dc\ub3c4 \uc911... (${a}/${o})`,progress:5,retryCount:a,maxRetries:o}),await c(r)}return await b(e)}catch(t){if(r=t instanceof Error?t:new Error(String(t)),console.warn(`[T-Ruby] Load attempt ${a+1} failed:`,r.message),r.message.includes("not supported")||r.message.includes("WebAssembly"))break}const s=y(r,"\ucef4\ud30c\uc77c\ub7ec \ub85c\ub4dc");throw new Error(s)}(e);try{return a=await u,i=0,a}catch(r){throw u=null,r}}async function b(e){try{console.log("[T-Ruby] Loading @t-ruby/wasm package..."),e?.({state:"loading",message:"T-Ruby \ucef4\ud30c\uc77c\ub7ec \ub85c\ub4dc \uc911...",progress:10,retryCount:i,maxRetries:o});const{TRuby:r}=await s.e(9134).then(s.bind(s,9134));e?.({state:"loading",message:"Ruby VM \ucd08\uae30\ud654 \uc911...",progress:30,retryCount:i,maxRetries:o});const n=new r;e?.({state:"loading",message:"T-Ruby \ub77c\uc774\ube0c\ub7ec\ub9ac \ub85c\ub4dc \uc911...",progress:50,retryCount:i,maxRetries:o}),await n.initialize(),e?.({state:"loading",message:"\ubc84\uc804 \uc815\ubcf4 \ud655\uc778 \uc911...",progress:90,retryCount:i,maxRetries:o}),l=await n.getVersion(),console.log("[T-Ruby] Version:",l),e?.({state:"ready",message:"\ucef4\ud30c\uc77c\ub7ec \uc900\ube44 \uc644\ub8cc",progress:100});return{async compile(e){try{console.log("[T-Ruby] Compiling:",e.substring(0,50)+"...");const a=await(r=n.compile(e),s=t,o="\ucef4\ud30c\uc77c",Promise.race([r,new Promise((e,r)=>setTimeout(()=>r(new Error(`Timeout: ${o}`)),s))]));return console.log("[T-Ruby] Compile result:",a),{success:a.success,ruby:a.ruby||"",rbs:a.rbs||"",errors:a.errors?.map(e=>e.message)||[]}}catch(a){console.error("[T-Ruby] Compile error:",a);return{success:!1,ruby:"",rbs:"",errors:[y(a,"\ucef4\ud30c\uc77c")]}}var r,s,o},healthCheck:()=>({loaded:n.isInitialized(),version:l?.tRuby||"unknown",ruby_version:l?.ruby||"unknown"}),getVersion:()=>({t_ruby:l?.tRuby||"unknown",ruby:l?.ruby||"unknown"}),cleanup(){console.log("[T-Ruby] Cleanup called")}}}catch(r){console.error("[T-Ruby] Failed to load compiler:",r);const s=y(r,"\ucef4\ud30c\uc77c\ub7ec \ub85c\ub4dc");throw e?.({state:"error",message:s}),r}}function g(){a&&a.cleanup(),a=null,u=null,l=null,i=0,console.log("[T-Ruby] Compiler cleaned up")}}}]);